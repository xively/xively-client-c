sudo: false
language: c
compiler:
  - clang
  - gcc

install:
  - git clone https://github.com/atigyi/xi_artifactory.git $HOME/xi_artifactory
  - cd $HOME/xi_artifactory
  - git checkout feature/cc3200_dependencies
  - $HOME/xi_artifactory/ti/ccsv6/tools/compiler/arm_15.12.3.LTS/bin/armcl --version

env:
  global:
    - XI_BSP_TLS=wolfssl
  matrix:
    # - PRESET=ARM_REL
    # - PRESET=ARM_REL_MIN

    - PRESET=POSIX_DEV
    # - PRESET=POSIX_DEV_MIN
    # - PRESET=POSIX_REL
    # - PRESET=POSIX_REL_MIN

    # - PRESET=POSIX_REL
      # XI_BSP_TLS=mbedtls

    # - PRESET=POSIX_THREADING_REL
    # - PRESET=POSIX_UNSECURE_REL
      # XI_BSP_TLS=""
cache:
    apt
addons:
  apt:
    sources:
      - llvm-toolchain-precise-3.8
      - ubuntu-toolchain-r-test
    packages:
      - clang-3.8
      - qemu-system
      - libc6:i386
matrix:
  exclude:
    - compiler: clang
      env: PRESET=ARM_REL_MIN
    - compiler: clang
      env: PRESET=ARM_REL
before_script:
  - "if [[ $CC == *'clang'* ]]; then export CC='clang-3.8'; fi"
script:
  - "set -e"
  - "ls -l $HOME"
  - "ls -lR $HOME/xi_artifactory"
  - "cd $HOME/build/xively/xively-client-c/"
  - "make PRESET=$PRESET XI_DEBUG_OUTPUT=0 tests"
  - "if [ ! $CC == 'gcc' ]; then
        make -C examples/mqtt_logic_example  XI_CLIENT_LIB_PATH=../../bin/linux XI_BSP_TLS=$XI_BSP_TLS;
        make -C examples/mqtt_logic_producer XI_CLIENT_LIB_PATH=../../bin/linux XI_BSP_TLS=$XI_BSP_TLS;
        make -C examples/mqtt_logic_consumer XI_CLIENT_LIB_PATH=../../bin/linux XI_BSP_TLS=$XI_BSP_TLS;
        make -C examples/mqtt_logic_example_two_contexts XI_CLIENT_LIB_PATH=../../bin/linux XI_BSP_TLS=$XI_BSP_TLS;
        make -C examples/mqtt_last_will       XI_CLIENT_LIB_PATH=../../bin/linux XI_BSP_TLS=$XI_BSP_TLS;

        if [ $CONFIG == senml ]; then
            make -C examples/senml_serializer XI_CLIENT_LIB_PATH=../../bin/linux XI_BSP_TLS=$XI_BSP_TLS;
        fi;
    fi;"
